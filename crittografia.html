<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Cifratura</title>
        <style>
            #corpo{
                display: flex;
            }
            .colonna{
                width: 50%;
            }
            input{
                width: 500px;
            }
            textarea{
                width: 500px;
                height: 200px;
                margin-bottom: 20px;
            }
            p{
                border-style: groove;
                height: 200px;
                width: 500px;
                /*overflow-y: auto;
                overflow-x: hidden;*/
                overflow-wrap: break-word;
            }
        </style>
    </head>
    <body>
        <h1>Cifratura stra sicura</h1>
        <div id="corpo">
            <div class="colonna">
                <h3>Da codificare</h3>
                <textarea type="text" id="c1" class="eccezione" placeholder="Inserisci un testo..."></textarea>
                <input type="text" id="chiave1" placeholder="Inserisci la chiave...">
                <br><br>
                <div>
                    <button onclick="cifra()">Cifra</button>
                    <select id="v1">
                        <option value="0" selected>Esadecimale</option>
                        <option value="1">Binario</option>
                    </select>
                    <label for="select">Base dell'output</label>
                </div>
                <p id="c2"></p>
            </div>
            <div class="colonna">
                <h3>Da codificare</h3>
                <textarea type="text" id="c3" class="eccezione" placeholder="Inserisci un testo cifrato..."></textarea>
                <input type="text" id="chiave2" placeholder="Inserisci la chiave...">
                <br><br>
                <div>
                    <button onclick="decifra()">Decifra</button>
                    <select id="v2">
                        <option value="0" selected>Esadecimale</option>
                        <option value="1">Binario</option>
                    </select>
                    <label for="select">Base dell'input</label>
                </div>
                <p id="c4"></p>
            </div>
        </div>
    </body>
    <script>
        let i;
        function cifra(){
            let testo = document.getElementById("c1").value;
            let chiave = document.getElementById("chiave1").value;
            let base = parseInt(document.getElementById("v1").value);
            let testoB = ConBin(testo);
            let chiaveB = ConBin(chiave);;
            let cifrato="",cifratoE="";
            
            //Allunga la chiave se corta
            while(chiaveB.length < testoB.length) {
                chiaveB += chiaveB;
            }
            chiaveB = chiaveB.substring(0, testoB.length);
            
            //Fa la cifratura
            for(i=0; i<testoB.length; i++){
                let v1 = testoB[i];
                let v2 = chiaveB[i];
                cifrato += XOR(v1,v2);
            }

            if(base == 0){
                for(i=0; i<cifrato.length; i += 8){
                    let temp = cifrato.substring(i,i+8);
                    let tempo = parseInt(temp, 2);
                    cifratoE += tempo.toString(16).padStart(2,'0');
                }
                document.getElementById("c2").innerHTML = cifratoE;
            }else{
                document.getElementById("c2").innerHTML = cifrato;
            }

        }

        function decifra(){
            let cifrato = document.getElementById("c3").value;
            let chiave = document.getElementById("chiave2").value;
            let base = parseInt(document.getElementById("v2").value);
            let chiaveB = ConBin(chiave);
            let cifratoB="",testo="",testoE="",testoB="";


            //converte il testo cifrato in binario
            if(base == 0){
                for(i=0; i<cifrato.length; i += 2){
                    let temp = cifrato.substring(i,i+2);
                    let tempo = parseInt(temp,16);
                    cifratoB += tempo.toString(2).padStart(8,'0');
                }
            }else{
                cifratoB = cifrato;
            }

            //Allunga la chiave se corta
            while(chiaveB.length < cifratoB.length) {
                chiaveB += chiaveB;
            }
            chiaveB = chiaveB.substring(0, cifratoB.length);

            //Fa la decifratura
            for(i=0; i<cifratoB.length; i++){
                //let v1 = cifratoB[i];
                //let v2 = chiaveB[i];
                testoB += XOR(cifratoB[i],chiaveB[i]);
            }
            
            for(i=0; i<testoB.length; i += 8){
                let temp = testoB.substring(i,i+8);
                let tempo = parseInt(temp,2);
                testo += String.fromCharCode(tempo);
            }

            document.getElementById("c4").innerHTML = testo;

        }

        function XOR(b1, b2) {
            return b1 == b2 ? "0" : "1";
        }

        function ConBin(bin){
            let binario = "";
            for(i=0; i<bin.length; i++){
                let temp = bin.charCodeAt(i); //converte il carattere nel numero ASCII
                let tempo = temp.toString(2);   //converte il numero in binario
                let tempi = tempo.padStart(8,'0');  //aggiunge gli zeri per essere a 8 bit
                binario += tempi;    //aggiunge il numero binario al testo binario
            }
            return binario;
        }
    </script>
</html>